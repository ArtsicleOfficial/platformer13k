<html><body style="background-color:black;user-select: none" oncontextmenu="return false;"><center><canvas id="game" width="800" height="600" style="background-color:aliceblue"></canvas><p style="color:white">Press P to add a new player. (Max of 2, first player uses arrow keys, second uses WASD. Second player optional.)</p></center><script>
players = []
objects = []
particles = []
subparticles = []
canvas = document.getElementById("game");
ctx = canvas.getContext("2d");
function createObject(x,y,w,h,collidable,color,onTouch) {
	if(onTouch != undefined) {
		objects.push({x,y,w,h,collidable,color,onTouch})
	} else {
		objects.push({x,y,w,h,collidable,color})
	}
	return objects[objects.length-1]
}
function uncollidableObject(x,y,w,h) {
	createObject(x,y,w,h,false,"100,100,100")
}
function object(x,y,w,h) {
	createObject(x,y,w,h,true,"0,0,0")
}

function cobjects(objects) {
	for(var o in objects) {
		var obj = objects[o];
		createObject(obj[0],obj[1],obj[2],obj[3],true,"0,0,0")
	}
}

function uncollidableObjects(objects) {
	for(var o in objects) {
		var obj = objects[o];
		createObject(obj[0],obj[1],obj[2],obj[3],false,"100,100,100")
	}
}
function createPlayer(x,y,w,h,collidable,color,controls,speed,id) {
	players.push({x,y,w,h,collidable,color,controls,gravity:0,move:{l:false,r:false},speed,id:id})
	return players[players.length-1]
}
function createParticle(x,y,color,size,amount,spreadX,speedY,life) {
	particles.push({x,y,color,size,amount,spreadX,speedY,did:0,life});
	return particles[particles.length-1]
}
function createSubParticle(parent) {
	subparticles.push({x:parent.x,y:parent.y,life:0,parent});
	return subparticles[particles.length-1]
}
/*REMOVE THIS FUNCTION IN THE MINIFIED VERSION*/
function log(string) {
	console.log(string);
}
/*REMOVE THIS FUNCTION IN THE MINIFIED VERSION!*/
window.addEventListener("keydown",function(k) {
	for(p in players) {
		var plr = players[p];
		switch(k.keyCode) {
		case plr.controls.r:
			plr.move.r=true;
			break;
		case plr.controls.l:
			plr.move.l=true;
			break;
		case plr.controls.u:
			if(playerInGround(plr)==true || winCheck){plr.gravity=-5};
			break;
		}
	}
	if(k.keyCode==80) {
		var p = players[0];
		if(players.length < 2) {
			createPlayer(294,150,p.w,p.h,p.collidable,p.color,{u:87,l:65,r:68},2,"2");
		}
	}
})
window.addEventListener("keyup",function(k) {
	for(p in players) {
		var plr = players[p];
		switch(k.keyCode) {
		case plr.controls.r:
			plr.move.r=false;
			break;
		case plr.controls.l:
			plr.move.l=false;
		}
	}
})

/*REMOVE THIS CODE IN THE MINIFIED VERSION!*/
/*var vec1;
var vec2;*/
//var created = [];
canvas.addEventListener("mousedown",function(k) {
	plr = players[0]
	if(plr != undefined) {
	var x = Math.round(((k.clientX-canvas.offsetLeft)-((800/2-(plr.w/2))-plr.x))/10)*10;
	var y = Math.round(((k.clientY-canvas.offsetTop)-((400)-plr.y))/10)*10;
	if(k.button == 2) {
		plr.x = x;
		plr.y = y;
		//t=!t;
		//log(t);
	} else {
		//vec1={x,y};
	}
	}
})
//var t = false;
/*canvas.addEventListener("mouseup",function(k) {
	if(k.button == 0) {
		var plr = players[0];
		var x = Math.round(((k.clientX-canvas.offsetLeft)-((800/2-(plr.w/2))-plr.x))/10)*10;
		var y = Math.round(((k.clientY-canvas.offsetTop)-((400)-plr.y))/10)*10;
		vec2={x:x-vec1.x,y:y-vec1.y};
		var obj = "[" + (vec1.x) + "," + (vec1.y) + "," + (vec2.x) + "," + (vec2.y) + "]";

		if(t) {
			createObject(vec1.x,vec1.y,vec2.x,vec2.y,false,"100,100,100")
		} else {
			createObject(vec1.x,vec1.y,vec2.x,vec2.y,true,"0,0,0")
		}
		created.push(obj);
		var createdStr = "";
		for(var i in created) {
			createdStr+=created[i] + "\n";
		}
		log(createdStr);
		createObject(vec1.x,vec1.y,vec2.x,vec2.y,true,"0,0,0")
	}
})*/
/*REMOVE THIS CODE IN THE MINIFIED VERSION!*/
function playerInGround(plr) {
	plr.y+=1;
	if(collide(plr)) {
		plr.y-=1;
		return true;
	}
	return false;
}
function getPlayerOffset(posX,posY) {
	var plr = players[0];
	return {x:Math.floor(posX-plr.x+(800/2-(plr.w/2))),y:Math.floor(posY-plr.y)+400};
}
function getPlayerPos() {
	return {x:Math.floor((800/2)-(plr.w/2)),y:400};
}
function drawObjects(collidable) {
	for(var o in objects) {
		var obj = objects[o];
		if(obj.collidable == collidable) {
			var obj = objects[o];
			ctx.fillStyle = "rgb(" + obj.color + ")";
			var plr = players[0]
			var position = getPlayerOffset(obj.x,obj.y);
			var x = position.x;
			var y = position.y;
			if(onScreen(x,y,obj.w,obj.h)) {
				ctx.fillRect(x,y,obj.w,obj.h);
			}
		}
	}
}
function indicator(id,posX,posY,off,pointX,pointY) {
		ctx.save();
		ctx.beginPath();
		ctx.font = "15px Verdana";
		ctx.textAlign = "center";
		if(pointX != undefined && pointY != undefined) {
			ctx.save();
			ctx.transform(0,1,1,0,posX+10,posY-off-15);
			ctx.rotate(Math.atan2(posX-pointX,posY-pointY))
			/*ctx.moveTo(0,0-15);
			ctx.lineTo(0+10,0-15);
			ctx.lineTo(0+5,0-5);*/
			
			ctx.moveTo(0,0);
			ctx.lineTo(15,5);
			ctx.lineTo(15,-5)
			ctx.restore();
			//ctx.fillRect(0,0,20,3);
		} else {
			ctx.moveTo(posX,posY-15-off);
			ctx.lineTo(posX+10,posY-15-off);
			ctx.lineTo(posX+5,posY-5-off);
			ctx.fillStyle = "rgb(0,100,0)"
			ctx.fillText(id,posX+5,posY-20-off)
		}
		ctx.lineWidth=2;
		var clr = "rgb(120,180,140)";
		ctx.strokeStyle=clr;
		ctx.fillStyle=clr;
		ctx.fill();
		ctx.stroke();
		ctx.restore();
		//ctx.lineTo(posX+2,posY-5);
		ctx.closePath();
}
function minMax(num,min,max) {
	if(num <= min) num=min;
	if(num >= max) num=max;
	return num;
}
function minOrMax(num,min,max) {
	if(num <= max/2) {
		num=min
	} else {
		num=max;
	}
	return num;
}
function drawPlayers() {
	if(players.length != 0) {
		var off = offset/10;
		var plr = players[0]
		ctx.fillStyle = "rgb(" + plr.color + ")";
		var posX = 800/2-(plr.w/2);
		var posY = 400
		ctx.fillRect(posX,posY,plr.w,plr.h);
		if(players.length > 1) {
			indicator(plr.id,posX,posY,off);
		}
		for(var p in players) {
			if(p != 0) {
				var pl = players[p];
				ctx.fillStyle = plr.color;
				var position = getPlayerOffset(pl.x,pl.y);
				var posX = position.x;
				var posY = position.y;
				ctx.fillRect(posX,posY,pl.w,pl.h);
				if(onScreen(posX,posY,pl.w,pl.h)) {
					indicator(pl.id,posX,posY,off,"down")
				} else {
					posX = minMax(posX,10,790);
					posY = minMax(posY,10,590);
					indicator(pl.id,posX,posY,off,position.x,position.y)
				}
			}
		}
	}
}
var sa = false;
function createObjects() {
	cobjects([[220,270,150,10],[210,220,10,50],[200,220,10,10],[370,240,10,30],[380,190,10,40],[370,230,10,10],[320,180,60,10],[310,140,10,40],[220,230,10,10],[180,120,10,40],[170,160,10,10],[180,170,10,10],[320,90,10,50],[280,80,40,10],[240,170,20,20],[170,90,10,30],[100,80,60,10],[170,80,10,10],[160,70,10,10],[270,40,10,40],[230,30,30,10],[260,20,10,10],[270,30,10,10],[190,20,40,10],[130,10,60,10],[80,20,50,10],[30,90,60,10],[90,80,10,10],[20,30,60,10],[-10,80,40,10],[-40,20,60,10],[-30,90,20,10],[-50,10,10,10],[-40,-30,10,40],[-30,-100,10,70],[-20,-140,10,30],[-20,-110,10,10],[0,-190,10,10],[10,-200,10,10],[20,-210,30,10],[60,-220,50,10],[50,-220,10,10],[120,-230,170,10],[110,-230,10,10],[-50,100,20,10],[-200,110,150,10],[-390,120,190,10],[-1150,150,170,10],[-1090,100,10,50],[-1080,90,10,10],[-1090,80,10,10],[-1100,70,10,10],[-1120,60,20,10],[-1130,70,10,10],[-1140,80,10,10],[-1150,90,10,10],[-1120,130,20,20],[-1130,110,10,10],[-1100,110,10,10],[-1140,90,60,10],[-1140,100,10,50],[-1330,160,180,10],[-1080,130,10,10],[-1150,130,10,10],[-1580,170,250,10],[-980,160,10,20],[-970,180,10,20],[-960,200,10,40],[-950,240,20,10],[-930,260,10,60],[-930,250,10,10],[-920,320,10,80],[-910,400,10,10],[-900,410,10,20],[-890,430,20,10],[-870,440,10,10],[-860,450,50,10],[-810,460,50,10],[-760,470,10,10],[-740,480,110,10],[-750,480,10,10],[-630,470,100,10],[-530,460,50,10],[-480,450,40,10],[-440,390,10,60],[-430,280,10,100],[-440,380,10,10],[-420,180,10,100],[-410,160,10,20],[-400,130,10,20],[-400,150,10,10],[-910,380,10,10],[-910,330,10,10],[-920,310,10,10],[-890,260,10,30],[-880,290,10,10],[-880,280,10,10],[-900,270,10,10],[-930,240,10,10],[-920,240,10,10],[-910,250,10,10],[-900,260,10,10],[-880,270,10,10],[-870,270,10,20],[-450,240,30,10],[-490,250,40,10],[-500,240,10,30],[-510,250,10,30],[-520,280,10,10],[-530,260,10,20],[-520,250,10,30],[-660,330,50,10],[-610,340,50,10],[-800,330,30,10],[-550,360,10,20],[-540,410,10,10],[-1760,180,180,10],[-2040,170,40,10],[-2080,150,40,10],[-2050,160,10,10],[-2090,100,10,50],[-2100,-10,10,110],[-2110,-50,10,40],[-1850,190,10,10],[-1860,200,10,20],[-1870,220,10,30],[-1880,240,10,10],[-1910,360,10,20],[-1900,380,30,10],[-1870,390,60,10],[-1810,400,50,10],[-1760,390,40,10],[-1720,380,20,10],[-1700,360,10,20],[-1690,330,10,30],[-1680,290,10,30],[-1680,320,10,10],[-1690,260,10,30],[-1700,240,10,20],[-1720,230,20,10],[-1740,220,20,10],[-1750,210,10,10],[-1760,190,10,20],[-1910,290,10,10],[-1900,270,10,20],[-1890,250,10,20],[-2090,300,180,10],[-2090,360,180,10],[-2200,360,100,10],[-2120,370,20,30],[-2090,370,20,30],[-2080,400,10,20],[-2230,420,150,10],[-2080,420,10,10],[-2510,-130,10,500],[-2500,160,10,10],[-2500,120,10,10],[-2500,80,10,10],[-2500,40,10,10],[-2500,0,10,10],[-2500,-40,10,10],[-2500,-80,10,10],[-2500,-120,10,10],[-2510,-180,10,50],[-2500,-190,120,10],[-2380,-200,90,10],[-2280,-200,60,10],[-2290,-210,10,10],[-2220,-190,50,10],[-2000,180,160,10],[-2210,180,210,10],[-2340,160,70,10],[-2360,150,20,10],[-2370,130,10,20],[-2380,70,10,60],[-2390,-100,10,170],[-2400,-60,10,10],[-2400,-100,10,10],[-2100,-100,40,10],[-2060,-90,30,10],[-2030,-80,10,10],[-2020,-70,10,30],[-2010,-40,10,50],[-2270,300,10,10],[-2240,330,10,10],[-2270,170,10,10],[-2220,170,10,10],[-2230,180,10,20],[-2260,180,10,10],[-2270,150,10,10],[-2260,140,30,10],[-2230,150,10,10],[-2220,160,10,10],[-2380,-100,280,10],[-2110,-80,10,30],[-2110,-90,10,10],[-2360,140,10,10],[-2500,210,130,10],[-2380,220,10,20],[-2330,250,10,30],[-2330,280,50,10],[-2290,290,10,20],[-2380,240,60,10],[-2280,310,50,10],[-2290,310,10,10],[-2240,320,10,10],[-2240,340,40,10],[-2210,350,10,20],[-2500,360,290,10],[-2240,300,10,10],[-2230,310,10,20],[-2280,210,10,10],[-2250,200,10,10],[-2170,-180,10,20],[-2160,-160,10,10],[-2160,-150,10,10],[-2150,-140,10,10],[-2380,-240,10,10],[-2380,-280,10,10],[-2390,-750,10,560],[-2380,-330,10,10],[-2380,-370,10,10],[-2380,-410,10,10],[-2380,-450,10,10],[-2380,-500,10,10],[-2380,-550,10,10],[-2380,-590,10,10],[-2380,-630,10,10],[-2380,-670,10,10],[-2380,-720,10,10],[-2380,-760,10,10],[-2390,-760,10,10],[-2370,-760,40,10],[-2210,-650,20,10],[-2190,-640,20,10],[-2170,-630,10,20],[-2160,-610,10,60],[-2170,-550,10,30],[-2210,-520,40,10],[-2290,-510,80,10],[-2310,-520,20,10],[-2320,-540,10,20],[-2330,-600,10,60],[-2320,-640,10,40],[-2310,-650,20,10],[-2290,-660,80,10],[-2090,-530,10,50],[-2080,-550,10,20],[-2070,-560,30,10],[-2040,-570,60,10],[-2080,-480,10,20],[-2070,-460,10,10],[-2060,-450,80,10],[-1980,-470,10,20],[-1970,-540,10,70],[-1980,-560,10,10],[-1970,-550,10,10],[-1790,-560,30,10],[-1760,-550,10,10],[-1760,-540,10,40],[-1770,-500,10,40],[-1800,-460,30,10],[-1870,-450,70,10],[-1890,-460,20,10],[-1900,-480,10,20],[-1910,-530,10,50],[-1900,-550,10,20],[-1890,-560,80,10],[-1810,-570,20,10],[-1530,-590,10,20],[-1680,-600,150,10],[-1590,-570,60,10],[-1730,-590,10,20],[-1730,-570,30,10],[-1610,-580,10,50],[-1620,-530,10,40],[-1600,-560,10,10],[-1630,-490,10,10],[-1640,-540,10,50],[-1630,-580,10,40],[-1700,-560,70,10],[-1680,-590,10,10],[-1660,-590,10,10],[-1550,-590,20,10],[-1640,-590,10,10],[-1620,-590,10,10],[-1600,-590,10,10],[-1720,-600,40,10],[-1700,-620,10,20],[-1720,-660,10,10],[-1730,-650,10,50],[-1740,-600,10,10],[-1510,-540,10,70],[-1500,-470,20,10],[-1480,-460,90,10],[-1390,-470,20,10],[-1370,-530,10,60],[-1410,-540,40,10],[-1450,-550,40,10],[-1490,-560,40,10],[-1500,-550,10,10],[-1280,-500,10,40],[-1270,-510,30,10],[-1240,-520,90,10],[-1150,-530,430,10],[-1270,-460,10,10],[-1260,-450,290,10],[-1010,-540,10,10],[-990,-570,10,40],[-970,-540,10,10],[-720,-520,50,10],[-670,-510,10,30],[-700,-480,30,10],[-740,-470,40,10],[-970,-460,230,10],[-560,-350,50,10],[-540,-340,10,10],[-570,-330,70,10],[-580,-320,10,10],[-670,-470,20,10],[-740,-450,50,10],[-690,-440,70,10],[-590,-310,10,20],[-580,-290,10,10],[-570,-280,60,10],[-510,-290,20,10],[-490,-310,10,20],[-500,-320,10,10],[-480,-310,50,10],[-440,-320,10,10],[-580,-260,90,10],[-290,80,10,10],[-310,70,10,10],[-330,-60,10,150],[-320,-60,80,10],[-310,-50,10,10],[-250,-230,10,170],[-330,-230,10,170],[-340,-210,10,20],[-370,-210,30,10],[-400,-220,70,10],[-240,-200,10,10],[-240,-210,40,10],[-240,-220,70,10],[-290,-110,10,10],[-290,-150,10,10],[-290,-190,10,10],[-290,-230,10,10],[-340,-260,10,30],[-340,-320,10,30],[-330,-330,90,10],[-240,-260,10,30],[-240,-320,10,30],[-350,-230,10,10],[-230,-230,10,10],[-10,-140,70,10],[-80,-140,60,10],[-120,-130,40,10],[-140,-120,20,10],[-150,-110,10,20],[-160,-90,10,40],[10,-190,80,10],[60,-140,50,10],[80,-150,10,10],[90,-160,10,10],[70,-170,10,10],[80,-180,10,10],[100,-180,10,10],[100,-170,10,10],[90,-180,10,10],[100,-150,10,10],[290,-220,150,10],[440,-210,70,10],[510,-200,70,10],[580,-190,10,20],[590,-170,10,110],[600,-60,10,230],[610,170,10,180],[620,350,10,30],[630,380,10,10],[640,390,40,10],[680,400,120,10],[800,410,240,10],[910,310,120,10],[1030,320,10,90],[980,370,50,10],[190,180,10,40],[-1710,-650,10,30],[-2230,370,10,50],[-250,-50,10,140],[900,320,10,50]]);
	uncollidableObjects([[240,180,10,90],[200,190,60,10],[290,90,10,50],[280,140,10,60],[270,150,40,10],[220,140,50,10],[190,130,30,10],[150,20,10,60],[100,30,10,50],[40,40,10,50],[70,40,10,50],[0,30,10,50],[-1130,110,40,40],[-1130,100,40,10],[-1130,80,40,10],[-1120,70,20,10],[-1080,100,10,10],[-1150,100,10,10],[-250,90,10,10],[-240,110,30,10],[-250,100,10,10],[-230,100,20,10],[-210,100,10,10],[-200,90,20,10],[-190,100,10,10],[-170,90,30,10],[-180,100,10,10],[-160,100,20,10],[-150,80,10,10],[-140,90,20,10],[-130,100,10,10],[-120,100,10,10],[-90,100,10,10],[-350,110,10,10],[-360,100,10,10],[-340,100,10,10],[-330,90,10,10],[-330,110,10,10],[-840,430,20,20],[-830,380,20,50],[-820,350,40,30],[-800,340,40,10],[-770,330,110,10],[-680,340,70,10],[-620,350,60,10],[-540,420,10,50],[-750,470,120,10],[-810,380,40,80],[-820,430,10,20],[-770,350,10,110],[-780,350,10,30],[-760,340,80,60],[-680,350,60,10],[-760,400,210,70],[-550,440,10,30],[-420,150,20,10],[-680,360,130,40],[-550,380,10,50],[-550,430,10,10],[-1790,350,10,50],[-1780,250,10,100],[-1770,180,10,60],[-1770,240,10,10],[-1760,160,10,20],[-1940,310,10,50],[-1950,310,30,10],[-1990,320,10,40],[-2000,310,30,10],[-2050,310,30,10],[-2040,320,10,40],[-2100,310,30,10],[-2090,320,10,40],[-1950,290,30,10],[-1940,200,10,90],[-1950,190,30,10],[-2000,190,30,10],[-1990,200,10,90],[-2000,290,30,10],[-2050,290,30,10],[-2040,200,10,90],[-2050,190,30,10],[-2100,290,30,20],[-2090,200,10,90],[-2100,190,30,10],[-2180,320,10,40],[-2190,250,10,70],[-2200,200,10,50],[-2210,190,30,10],[-2190,350,30,10],[-2310,250,10,30],[-2300,230,10,20],[-2290,220,20,10],[-2260,210,60,10],[-2270,210,10,10],[-2320,270,30,10],[-2490,160,150,10],[-2490,120,110,10],[-2490,80,110,10],[-2490,40,100,10],[-2490,0,100,10],[-2490,-40,100,10],[-2490,-80,100,10],[-2500,-60,100,10],[-2500,-100,100,10],[-2490,-120,100,10],[-2390,-110,50,10],[-2320,-190,20,10],[-2310,-180,10,70],[-2310,-110,10,10],[-2230,-180,20,10],[-2230,-190,10,10],[-2230,-170,10,20],[-2240,-150,10,40],[-2250,-110,10,10],[-1610,-630,10,30],[-1620,-670,10,40],[-1630,-680,10,10],[-1640,-670,10,50],[-1630,-620,10,20],[-980,-540,10,10],[-1000,-540,10,10],[-1030,-540,10,10],[-950,-540,10,10],[-570,-270,10,10],[-520,-270,10,10],[-440,-330,10,10],[-580,-310,10,10],[-570,-320,10,10],[-550,-310,20,30],[-270,90,10,10],[-290,100,10,10],[-310,110,10,10],[-290,60,10,10],[-270,50,10,10],[-270,-20,10,10],[80,-170,20,20],[100,-160,10,10],[-320,-230,70,10],[-320,-190,70,10],[-320,-150,70,10],[990,400,40,10],[900,390,90,10],[800,400,100,10],[680,390,120,10],[640,380,40,10],[630,370,10,10],[620,340,10,10],[610,350,10,20],[620,380,10,10],[560,290,50,10],[510,340,60,10],[570,330,40,10],[490,280,70,10],[410,330,100,10],[400,270,90,10],[380,260,20,10],[370,320,40,10],[310,300,50,10],[270,200,10,40],[260,240,10,30],[250,300,60,10],[240,290,10,10],[150,180,40,10],[140,140,10,40],[150,130,10,10],[160,120,10,10],[170,150,10,10],[300,70,10,10],[270,20,10,10],[230,20,30,10],[-310,0,10,10],[-290,10,10,10],[-290,-40,10,10],[-270,-70,20,10],[-320,-70,20,10],[-320,-110,30,10],[-280,-110,30,10],[-880,260,20,10],[-340,-270,10,10],[-240,-270,10,10],[-230,-320,10,10],[-350,-320,10,10],[-320,-340,70,10],[-410,-330,60,10],[-220,-330,60,10],[-650,-400,50,10],[-600,-390,10,40],[-590,-350,10,20],[-620,-330,30,10],[-650,-320,30,10],[-660,-340,10,20],[-670,-390,10,50],[-660,-400,10,10],[-680,-450,60,10],[-670,-520,10,10],[-840,-540,60,10],[-830,-550,40,10],[-720,-530,20,10],[-740,-540,20,10],[-910,-540,40,10],[-1220,-530,40,10],[-1180,-540,30,10],[-1150,-550,40,10],[-1110,-540,50,10],[-1320,-510,50,10],[-1330,-500,10,30],[-1340,-470,10,40],[-1330,-430,50,10],[-1280,-420,40,10],[-1240,-430,20,10],[-1220,-440,10,10],[-1210,-440,10,10],[-1200,-470,10,20],[-1210,-500,10,30],[-1240,-510,30,10],[-1260,-520,20,10],[-1270,-500,10,10],[-1430,-500,30,10],[-1400,-510,10,10],[-1390,-530,10,20],[-1500,-500,10,20],[-1490,-510,10,10],[-1480,-520,30,10],[-1530,-570,10,10],[-1590,-610,40,10],[-1690,-610,20,10],[-1700,-650,10,30],[-1710,-660,10,10],[-1720,-670,10,10],[-2020,-490,10,20],[-2010,-500,20,10],[-1820,-530,40,10],[-1780,-520,10,30],[-1870,-510,10,20],[-1860,-520,20,10],[-2060,-520,10,40],[-2050,-500,10,10],[-2070,-500,10,10],[-2080,-510,10,10],[-2040,-510,10,10],[-2150,-110,90,10],[-2060,-100,30,10],[-2150,-150,10,10],[-2160,-170,10,10],[-2170,-190,10,10],[-2220,-200,10,10],[-2290,-200,10,10],[-2230,430,160,10],[-2390,430,160,10],[-2390,440,10,50],[-2510,480,120,10],[-2610,380,10,320],[-2510,490,10,210],[-2600,690,90,10],[-2390,390,10,40],[-2290,420,10,10],[-2340,410,10,10],[-2510,400,10,80],[-2410,470,10,10],[-2450,460,10,10],[-2500,440,10,10],[-2500,390,10,10],[-2610,360,100,10],[-2610,370,10,10],[-2500,350,290,10],[-820,310,20,10],[-850,290,10,10],[-950,200,10,40],[-960,190,10,10],[-940,220,20,20],[-1030,110,10,40],[-1040,100,30,10],[-1050,90,50,10],[-1050,80,40,10],[-1040,70,30,10],[-1230,140,10,20],[-1240,150,10,10],[-1250,140,10,10],[-1260,140,10,20],[-1270,150,10,10],[-1280,140,10,10],[-1290,140,10,20],[-1290,130,10,10],[-1300,140,10,10],[-1310,150,10,10],[-1310,140,10,10],[-1330,140,20,20],[-1350,150,20,20],[-1360,160,10,10],[-1370,150,10,10],[-1360,150,10,10],[-1380,160,10,10],[-1390,150,10,20],[-1400,160,10,10],[-1460,150,10,20],[-1470,160,10,10],[-1500,150,10,10],[-1490,150,20,20],[-1510,160,10,10],[-1550,160,10,10],[-1540,150,10,20],[-1560,150,10,10],[-1590,160,30,10],[-1590,170,10,10],[-1590,150,20,10],[-1600,160,10,10],[-1610,170,10,10],[-1620,160,10,10],[-1630,170,10,10],[-1640,160,10,10],[-1630,160,10,10],[-1620,170,10,10],[-1690,170,20,10],[-1680,160,10,10],[-1660,170,10,10],[-1820,380,10,10],[-1880,370,10,10],[-1910,350,10,10],[-1910,300,10,10],[-1900,260,10,10],[-1880,230,10,10],[-1860,190,10,10],[-1910,190,20,10]]);

	createObject(1000,350,20,20,true,"200,200,190",function() {
		for(var i in players) {
			var plr = players[i]
			plr.color = "100,100,100";
			plr.collidable = false;
		}
		document.body.style.backgroundColor = "rgb(100,100,100)"
	});
	createObject(-2600,650,90,40,false,"0,100,0",function() {
		win();
	});

	createParticle(-840,420,"250,150,50",2,30,5,-1,200)
	createParticle(-840,420,"250,100,100",2,30,5,-1,200)

	createParticle(-830,370,"250,150,50",2,30,5,-1,200)
	createParticle(-830,370,"250,100,100",2,30,5,-1,200)

	createParticle(-740,320,"250,150,50",2,30,5,-1,200)
	createParticle(-740,320,"250,100,100",2,30,5,-1,200)

	createParticle(-700,330,"250,150,50",2,30,5,-1,200)
	createParticle(-700,330,"250,100,100",2,30,5,-1,200)

	createParticle(-600,350,"250,150,50",2,30,5,-1,200)
	createParticle(-600,350,"250,100,100",2,30,5,-1,200)

	createParticle(-540,400,"250,150,50",2,30,5,-1,200)
	createParticle(-540,400,"250,100,100",2,30,5,-1,200)

	createPlayer(294,170,10,20,true,"0,0,0",{l:37,u:38,r:39},2,"1");
}

function calculateGravity(g) {
	return g+(10/60);
}
function isColliding(x,y,w,h,x2,y2,w2,h2) {
	return (x+w> x2 && x < x2+w2 && y+h > y2 && y < y2+h2)
}
function onScreen(x,y,w,h) {
	if(x+w>=0 && x <= 800 && y+h >= 0 && y <= 600) {
		return true
	}
	return false
}
function collide(plr) {
	for(var o in objects) {
		var obj = objects[o];
		if(isColliding(plr.x,plr.y,plr.w,plr.h,obj.x,obj.y,obj.w,obj.h)==true && obj.collidable == plr.collidable) {
			if(obj.onTouch != undefined) {
				obj.onTouch();
			}
			return true;
		}
	}
	for(var p in players) {
		var pl = players[p];
		if(plr.id !== pl.id) {
			if(isColliding(plr.x,plr.y,plr.w,plr.h,pl.x,pl.y,pl.w,pl.h)==true && pl.collidable == plr.collidable) {
				return true;
			}
		}
	}
	return false;
}
var offset = 25;
var up = true;
function logicPlayers() {
	if(up) {
		offset++;
	} else {
		offset--;
	}
	if(offset >= 50) {
		up = false;
	}
	if(offset <= 0) {
		up = true;
	}
	for(let p in players) {
		var plr = players[p];
		plr.gravity=calculateGravity(plr.gravity);
		plr.y+=plr.gravity
		if(plr.gravity >= 40) {
			location.reload();
		}
		if(collide(plr)==true) {
			plr.y-=plr.gravity
			plr.gravity = 0
		}
		if(plr.move.r) {
			plr.x+=plr.speed;
			if(collide(plr)==true) {
				plr.x-=plr.speed;
				for(i=0;i<plr.speed;i++) {
					plr.x+=i;
					if(collide(plr)==true)plr.x-=i;
				}
			}
		}
		if(plr.move.l) {
			plr.x-=plr.speed;
			if(collide(plr)==true) {
				plr.x+=plr.speed;
				for(i=0;i<plr.speed;i++) {
					plr.x-=i;
					if(collide(plr)==true)plr.x+=i;
				}
			}
		}

	}
}
var tick = 0;
function randInt(min,max) {
	return Math.random() * (max - min) + min;
}
function clearGame() {
	for(var i in particles) {
		delete particles[i];
	}
	for(var i in objects) {
		delete objects[i];
	}
	for(var i in players) {
		delete players[i];
	}
	for(var i in subparticles) {
		delete subparticles[i];
	}
}
function logicParticles() {
	for(var p in particles) {
		var particle = particles[p];
		var amtsixth = particle.amount/60;
		particle.did++;
		if(amtsixth*particle.did >= 1) {
			particle.did = 0;
			createSubParticle(particle);
		}
		if(tick == 60) {
			particle.did = 0;
		}
	}
	for(var sp in subparticles) {
		var subparticle = subparticles[sp]
		subparticle.life++;
		if(subparticle.life > subparticle.parent.life) {
			delete subparticles[sp];
		}
		subparticle.y+=subparticle.parent.speedY;
		subparticle.x+=randInt(-subparticle.parent.spreadX,subparticle.parent.spreadX);
	}

}
function drawParticles() {
	for(var sp in subparticles) {
		var pos;
		var subparticle = subparticles[sp];
		if(players.length == 0) {
			pos = {x:subparticle.x,y:subparticle.y}
		} else {
			pos = getPlayerOffset(subparticle.x,subparticle.y);
		}
		ctx.fillStyle = "rgb("+subparticle.parent.color+")";
		if(onScreen(pos.x,pos.y,subparticle.parent.size,subparticle.parent.size)) {
			ctx.fillRect(pos.x,pos.y,subparticle.parent.size,subparticle.parent.size);
		}
	}
}
var winCheck = false;
function win() {
	if(winCheck == false) {
		var ele = document.createElement("p")
		ele.innerHTML = "Good job, You Win! You now have infinite jumping power!";
		ele.style.color = "white";
		ele.style.textAlign = "center";
		ele.style.fontSize = "45px";
		document.body.insertBefore(ele,document.body.firstChild);
		winCheck = true;
	}
}
var screen = 0;
ctx.textAlign = "center"
function loop() {
	window.requestAnimFrame(function() {
		loop();
	});

	logicPlayers();
	logicParticles();

	tick++;
	if(tick > 60) {
		tick =0;
	}
	ctx.clearRect(0,0,800,600);
	drawObjects(false);
	drawParticles();
	drawObjects(true);
	drawPlayers();
	if(screen == 0) {
		//Had to hardcode this, if I had the filesize to spare i'd add a new text object
		ctx.font = "40px Verdana";
		ctx.fillStyle = "black";
		ctx.fillText("Click to play",800/2,600/2)
	}
}

window.requestAnimFrame = (function() {
	return window.requestAnimationFrame ||
		   window.webkitRequestAnimationFrame ||
		   window.oRequestAnimationFrame ||
		   window.setTimeout(function(callback){},1000/60);
})();
titleParticle = createParticle(5,5,"0,0,100",7,60,5,-3,50)
canvas.addEventListener("mousemove",function(e) {
	if(screen == 0) {
		if(titleParticle != undefined) {
			titleParticle.x = e.clientX-canvas.offsetLeft
			titleParticle.y = e.clientY-canvas.offsetTop
		}
	}
})
canvas.addEventListener("mousedown",function(e) {
	if(screen == 0) {
		screen = 1;
		clearGame();
		createObjects();
	}
})
//createObjects();

loop();
</script></body>
</html>